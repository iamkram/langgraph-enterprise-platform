sequenceDiagram
    participant User
    participant UI as React UI
    participant tRPC as tRPC Gateway
    participant Auth as OAuth Handler
    participant API as Agent CRUD API
    participant CodeGen as Code Generator
    participant DB as MySQL/TiDB
    participant S3 as S3 Storage
    participant LLM as LLM API

    User->>UI: Create New Agent
    UI->>tRPC: agents.create(config)
    tRPC->>Auth: Validate Session
    Auth-->>tRPC: User Context
    tRPC->>API: Create Agent
    API->>DB: INSERT agent_configs
    DB-->>API: Agent ID
    API->>CodeGen: Generate Code
    CodeGen->>LLM: Generate with Template
    LLM-->>CodeGen: Generated Code
    CodeGen->>S3: Store Code Files
    S3-->>CodeGen: File URLs
    CodeGen->>DB: INSERT generated_code
    DB-->>CodeGen: Success
    CodeGen-->>API: Code Generated
    API-->>tRPC: Agent Created
    tRPC-->>UI: Success + Agent ID
    UI-->>User: Show Agent Details
    
    Note over User,LLM: Average latency: 2-5 seconds
    Note over DB: All operations in transaction
    Note over S3: Code stored with version control
